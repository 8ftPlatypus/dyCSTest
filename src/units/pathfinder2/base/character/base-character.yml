unit: base/character
name: "_{Character}"

form:
  - select: ancestry
    name: "_{Ancestry}"
    max: 1
  - select: background
    name: "_{Background}"
    max: 1
  - select: class
    name: "_{Class}"
    max: 1
  - select: archetype
    name: "_{Archetype}"
    max: 3

  - option: build
    name: "_{Build A Character}"
    unit: option/build
  - option: cover
    name: "_{Cover Page}"
    unit: option/cover
  - option: minis
    name: "_{Map Minis}"
    unit: option/minis

  - select: inventory
    name: "_{Inventory}"
    max: 1
    default: half

inc:

  - at: '@pages'
    add:

      - page: character
        name: "_{Character}"
        order: 5
        flex: true
        contents:
          - layout: 2l
            contents:
              - g:
                contents:
                  - logo:

                  - section:
                    untitled: true
                    contents:
                      - row:
                        contents:
                          - field: player-name
                            label: "_{Player}"
                            width: stretch
                            align: left
                          - field: hero-points
                            label: "_{Hero Points}"
                            border: circle
                            size: huge
                            suffix: "3"

                      - row:
                        contents:
                          - field: campaign-name
                            label: "_{Campaign}"
                            width: stretch
                            align: left
                          - field: xp
                            label: "_{XP}"
                            underlay: "_{XP}"
                            width: large
                            border: full

                      - zone: '@player-header'
                  - hr:
                    swash: true

                  - portrait: personal

                  - section:
                    id: ident
                    untitled: true
                    contents:
                      - list:
                        zebra: true
                        hr: true
                        contents:
                          - g:
                            contents:
                              - field: character-name
                                legend: "_{Character Name}"
                                size: huge
                                width: stretch
                                align: left
                              - layout: alignment
                                gutter: none
                                contents:
                                  - g:
                                    contents:
                                      - row:
                                        contents:
                                          - field: gender
                                            label: "_{Gender}"
                                            icon: gender
                                            width: large
                                          - spacer:
                                          - field: age
                                            label: "_{Age}"
                                            width: large
                                          - spacer:
                                          - field: size
                                            label: "_{Size}"
                                            icon: size
                                            width: large
                                          - spacer:
                                      - field: deity
                                        label: "_{Deity}"
                                        width: stretch
                                        # merge-bottom: true
                                  - field: alignment
                                    frame: none
                                    control: alignment
                              - field: languages
                                label: "Languages"
                                width: stretch
                                repeat: 2
                                merge-bottom: true
                          - g:
                            contents:
                              - h5: "_{Abilities}"
                              - layout: 6e
                                gutter: none
                                contents:
                                  - repeat: 6
                                    rows:
                                      - name: "_{Strength}"
                                        short: "_{STR}"
                                        code: STR
                                      - name: "_{Dexterity}"
                                        short: "_{DEX}"
                                        code: DEX
                                      - name: "_{Constitution}"
                                        short: "_{CON}"
                                        code: CON
                                      - name: "_{Intelligence}"
                                        short: "_{INT}"
                                        code: INT
                                      - name: "_{Wisdom}"
                                        short: "_{WIS}"
                                        code: WIS
                                      - name: "_{Charisma}"
                                        short: "_{CHA}"
                                        code: CHA
                                    contents:
                                      - g:
                                        valign: top
                                        contents:
                                          - row: center
                                            contents:
                                              - spacer:
                                              - field: "#{code}"
                                                label: "#{name}"
                                                border: circle
                                                size: huge
                                                # underlay: "#{short}"
                                                eq: "(%{#{code}-score}-10)/2"
                                              - spacer:
                                          - row: center
                                            contents:
                                              - field: "key-ability"
                                                control: radio
                                                frame: none
                                                value: "#{code}"
                                          - row: center
                                            contents:
                                              - spacer:
                                              - field: "#{code}-score"
                                                # prefix: "+"
                                                frame: none
                                                underlay: "#{short}"
                                              - spacer:
                              - p: "_{Ability Modifier = (Ability Score - 10) &divide; 2}"
                                align: left

                          - g:
                            contents:
                              - h5: "_{Proficiency}"
                              - layout: 5e
                                gutter: none
                                valign: top
                                flex: none
                                contents:
                                  - g:
                                    valign: top
                                    contents:
                                      - field: proficiency-untrained
                                        label: "_{Untrained}"
                                        border: full
                                        control: proficiency
                                        value: [ "untrained", 0 ]
                                      - label: "_{None}\n"
                                        align: center
                                      - spacer:
                                  - g:
                                    valign: top
                                    contents:
                                      - field: proficiency-trained
                                        label: "_{Trained}"
                                        border: full
                                        control: proficiency
                                        value: trained
                                      - label: "_{Level}\n+2"
                                        align: center
                                  - g:
                                    valign: top
                                    contents:
                                      - field: proficiency-expert
                                        label: "_{Expert}"
                                        border: full
                                        control: proficiency
                                        value: expert
                                      - label: "_{Level}\n+4"
                                        align: center
                                  - g:
                                    valign: top
                                    contents:
                                      - field: proficiency-master
                                        label: "_{Master}"
                                        border: full
                                        control: proficiency
                                        value: master
                                      - label: "_{Level}\n+6"
                                        align: center
                                  - g:
                                    valign: top
                                    contents:
                                      - field: proficiency-legendary
                                        label: "_{Legendary}"
                                        border: full
                                        control: proficiency
                                        value: legendary
                                      - label: "_{Level}\n+8"
                                        align: center
                  - tail:

              - g:
                contents:
                  - section: "_{Character}"
                    contents:
                      - list:
                        hr: true
                        zebra: true
                        avoid-shade: true
                        contents:
                          - row:
                            contents:
                              - field: ancestry
                                legend: "_{Ancestry}"
                                width: stretch
                                merge-bottom: true
                              - field: heritage
                                label: "_{Heritage}"
                                width: stretch
                                merge-bottom: true

                          - g:
                            contents:
                              - field: char-background
                                legend: "_{Background}"
                                width: stretch
                                merge-bottom: true
                                # value: '#{background}'

                          - row:
                            contents:
                              - class-icon:
                                size: tiny
                              - field: class
                                width: stretch
                                legend: "_{Class}"
                                merge-bottom: true
                              - zone: '@class-specialisation'
                                contents:
                                  - field: class-specialisation
                                    label: "_{Subclass}"
                                    width: stretch
                                    merge-bottom: true
                              - field: level
                                label: "_{Level}"
                                border: full

                          - g:
                            flex: tiny
                            contents:
                              - h5: "_{Archetypes}"
                              - list:
                                collapse: true
                                zebra: true
                                contents:
                                  - repeat: 3
                                    field_frame: none
                                    merge-bottom: true
                                    contents:
                                      - row:
                                        contents:
                                          - field: archetype-#{i}-name
                                            width: stretch
                                            align: left
                                            frame: none
                                          - field: archetype-#{i}-feats
                                            frame: none
                                            control: progression
                                            parts:
                                              - control: checkbox
                                              - control: checkbox
                                              - control: checkbox
                              - p: "_{You must take three archetype feats before you can start another.}"
                                optional: true

                  - section: "_{Skills}"
                    id: skills
                    contents:
                      - table:
                        collapse: true
                        zebra: true
                        field_frame: none
                        sort_by: name
                        width: stretch
                        columns:
                          -
                          - label: "_{Assurance}"
                            align: right
                          - "_{Skill\nBonus}"
                          -
                          - "_{Ability\nModifier}"
                          - "_{Proficiency}"
                          - "_{Feats\nMisc}"
                          - "_{Armour\nCheck\nPenalty}"
                        rows:
                          - slots:
                            min: 21
                            reduce: 2
                            contents:
                              - sort: name
                                contents:
                                  - zone: '@skills'
                                    contents:
                                      - skill: acrobatics
                                        name: "_{Acrobatics}"
                                        ability: "_{DEX}"
                                        abilityref: DEX
                                        acp: true
                                      - skill: arcana
                                        name: "_{Arcana}"
                                        ability: "_{INT}"
                                        abilityref: INT
                                        acp: false
                                      - skill: athletics
                                        name: "_{Athletics}"
                                        ability: "_{STR}"
                                        abilityref: STR
                                        acp: true
                                      - skill: crafting
                                        name: "_{Crafting}"
                                        ability: "_{INT}"
                                        abilityref: INT
                                        acp: false
                                      - skill: deception
                                        name: "_{Deception}"
                                        ability: "_{CHA}"
                                        abilityref: CHA
                                        acp: false
                                      - skill: diplomacy
                                        name: "_{Diplomacy}"
                                        ability: "_{CHA}"
                                        abilityref: CHA
                                        acp: false
                                      - skill: intimidation
                                        name: "_{Intimidation}"
                                        ability: "_{CHA}"
                                        abilityref: CHA
                                        acp: false
                                      - skill: medicine
                                        name: "_{Medicine}"
                                        ability: "_{WIS}"
                                        abilityref: WIS
                                        acp: false
                                      - skill: nature
                                        name: "_{Nature}"
                                        ability: "_{WIS}"
                                        abilityref: WIS
                                        acp: false
                                      - skill: occultism
                                        name: "_{Occultism}"
                                        ability: "_{INT}"
                                        abilityref: INT
                                        acp: false
                                      - skill: performance
                                        name: "_{Performance}"
                                        ability: "_{CHA}"
                                        abilityref: CHA
                                        acp: false
                                      - skill: religion
                                        name: "_{Religion}"
                                        ability: "_{WIS}"
                                        abilityref: WIS
                                        acp: false
                                      - skill: society
                                        name: "_{Society}"
                                        ability: "_{INT}"
                                        abilityref: INT
                                        acp: false
                                      - skill: stealth
                                        name: "_{Stealth}"
                                        ability: "_{DEX}"
                                        abilityref: DEX
                                        acp: true
                                      - skill: survival
                                        name: "_{Survival}"
                                        ability: "_{WIS}"
                                        abilityref: WIS
                                        acp: false
                                      - skill: thievery
                                        name: "_{Thievery}"
                                        ability: "_{DEX}"
                                        abilityref: DEX
                                        acp: true
                                        fade: false
                                  - slots:
                                    min: 2
                                    max: 2
                                    placeholder:
                                      - skill: lore
                                        name: "_{Lore}"
                                        ability: "_{INT}"
                                        abilityref: INT
                                        acp: false
                                        fade: true
                                    contents:
                                      - zone: '@lore-skills'
                                        contents:
                            placeholder:
                              skill: ''
                              name: ''
                              ability: ''
                              acp: false
                              optional: true
                        template:
                          - h6: "#{name}"
                            fade: "#{fade}"
                            blk: false
                          - field: "#{skill}-assurance"
                            control: checkbox
                            align: right
                          - field: "#{skill}-bonus"
                            border: full
                            icon: bonus
                          - span: "="
                          - field:
                            ref: "#{abilityref}"
                            underlay: "#{ability}"
                            frame: h-label
                            label: "#{ability}"
                          - field: "#{skill}-proficiency"
                            control: proficiency
                          - field: "#{skill}-misc"
                            misc: true
                          - field: "#{skill}-acp"
                            ref: acp
                            border: full
                            exists: "#{acp}"
                            prefix: "&ndash;"

                      - hr:
                      - list:
                        merge-bottom: true
                        contents:
                          - repeat: 5
                            contents:
                              - row:
                                contents:
                                  - field: "skill-note-#{i}-value"
                                    control: icon
                                    icon: proficiency
                                    frame: none
                                  - field: "skill-note-#{i}-name"
                                    frame: none
                                    width: stretch
                                  - field: "skill-note-#{i}-action"
                                    control: icon
                                    frame: none
                                    icon: action-template
                                    width: large
                                  - field: "skill-note-#{i}-notes"
                                    frame: none
                                    width: stretch

                  - section: "_{Perception}"
                    flex: small
                    contents:
                      - row:
                        contents:
                          - calc:
                            output:
                              field: perception
                              icon: bonus
                              legend: "_{Perception}"
                              width: large
                              eq: '%{WIS}+%{perception-proficiency}+%{perception-item-bonus}+%{perception-misc}'
                            inputs:
                              - field:
                                ref: "WIS"
                                underlay: "_{WIS}"
                                label: "_{WIS}"
                              - span: "+"
                              - field: perception-proficiency
                                label: "_{Proficiency}"
                                control: proficiency
                              - span: "+"
                              - field: perception-item-bonus
                                label: "_{Item}"
                              - span: "+"
                              - field: perception-misc
                                misc: true
                                label: "_{Misc}"
                          - spacer:
                          - zone: '@perception-misc'
                      - row: left
                        contents:
                          - p: "_{Perception DC = 10 + Perception Bonus}"
                          - spacer:
                          - field: perception-low-light
                            frame: right
                            control: checkbox
                            label: "_{Low-light vision}"
                          - field: perception-darkvision
                            frame: right
                            control: checkbox
                            label: "_{Dark vision}"
                          - field: perception-scent
                            frame: right
                            control: checkbox
                            label: "_{Scent}"
                      - zone: '@perception'
                        contents:
                          - row:
                            contents:
                              - field: perception-other
                                frame: none
                                align: left
                                width: stretch
                                repeat: 2
                                merge-bottom: true
                                optional: true
                  - tail:

      - page: combat
        name: "_{Combat}"
        order: 6
        flex: true
        contents:
          - layout: 2l
            contents:
              - g:
                contents:

                  - section: "_{Speed}"
                    id: speed
                    contents:
                      - row:
                        contents:
                          - layout: 3e
                            contents:
                              - action: 1
                                contents:
                                  - p: "_{Stride}"
                              - field: speed
                                legend: "_{Speed}"
                                control: speed
                                border: full
                                width: stretch
                              - field: speed-armour
                                label: "_{Speed in Armour}"
                                control: speed
                                width: stretch

                      - row:
                        contents:
                          - layout: 3e
                            contents:
                              - field: speed-swim
                                label: "_{Swim Speed}"
                                control: speed
                                width: stretch
                              - field: speed-climb
                                label: "_{Climb Speed}"
                                control: speed
                                width: stretch
                              - field: speed-fly
                                label: "_{Fly Speed}"
                                control: speed
                                width: stretch
                      - zone: '@speed'

                  - zone: '@weapon-spec-section'

                  - section: "_{Actions}"
                    id: actions
                    flex: large
                    contents:
                      - list:
                        zebra: true
                        flex: true
                        hr: true
                        contents:
                          - slots:
                            min: 3
                            max: 3
                            reduce: 1
                            placeholder:
                              action: template
                              contents:
                                - article:
                                  lines: 2
                                  reduce: 1
                            contents:
                              - zone: '@actions'

              - g:
                contents:
                  - section: "_{Attacks}"
                    id: attacks
                    contents:
                      - list:
                        zebra: true
                        hr: true
                        flex: true
                        avoid-shade: true
                        contents:

                          - repeat: 4
                            contents:
                              - paste: weapon
                                params:
                                  i: '#{i}'

                          - g:
                            merge-bottom: true
                            contents:
                              - layout: 2e
                                contents:
                                  - paste: ammo
                                    params:
                                      i: 1
                                      max: 20
                                      legend: "_{Ammo}"
                                  - paste: ammo
                                    params:
                                      i: 1
                                      max: 10
                                      label: "_{Special}"
                              - layout: 2e
                                contents:
                                  - paste: ammo
                                    params:
                                      i: 1
                                      max: 20
                                      merge-bottom: true
                                  - paste: ammo
                                    params:
                                      i: 1
                                      max: 10
                                      merge-bottom: true

          - layout: 2r
            contents:
              - g:
                contents:
                  - section: "_{Health}"
                    # icon: hp
                    id: health
                    contents:
                      - row:
                        layout: split
                        contents:
                          - calc:
                            output:
                              field: hp
                              legend: "_{Hit Points}"
                              icon: hp
                              suffix: "_{hp}"
                              width: large
                              eq: '%{hp-ancestry}+((%{hp-class}+%{CON})*%{level})'
                            inputs:
                              - field: hp-ancestry
                                label: "_{Ancestry}"
                              - span: "+ ("
                              - field: hp-class
                                label: "_{Class}"
                              - span: "+"
                              - field:
                                label: "_{CON}"
                                underlay: "_{CON}"
                                ref: CON
                              - span: ") &times;"
                              - field:
                                ref: level
                                label: "_{Level}"
                              - span: "+"
                              - field:
                                label: "_{Misc}"
                                optional: true
                                misc: true

                      - row:
                        contents:
                          - field: current-hp
                            label: "_{Current Hit Points}"
                            border: full
                            temp: true
                            icon: hp
                            suffix: "_{hp}"
                            width: stretch
                          - field: temp-hp
                            label: "_{Temp Hit Points}"
                            border: full
                            temp: true
                            suffix: "_{hp}"
                            width: huge
                            blk: true

                          - field: dying
                            control: progression
                            label: "_{Dying}"
                            parts:
                              - id: dying-1
                                control: checkbox
                              - id: dying-2
                                control: checkbox
                              - id: dying-3
                                control: checkbox
                              - id: dying-4
                                control: checkbox
                              - icon: evil
                                size: small
                                optional: true

                      - hr:
                      - h5: "_{Effects}"
                      - layout: 2e
                        contents:
                          - repeat: 2
                            contents:
                              - g:
                                contents:
                                  - row:
                                    contents:
                                      - field: effect-#{i}
                                        control: progression
                                        frame: none
                                        parts:
                                          - id: effect-#{i}-1
                                            control: checkbox
                                          - id: effect-#{i}-2
                                            control: checkbox
                                          - id: effect-#{i}-3
                                            control: checkbox
                                      - field: effect-#{i}
                                        width: stretch
                                        frame: none
                                      - field: effect-#{i}-duration
                                        frame: none
                                        underlay: "#"
                                        affix: "_{rds}"
                                        width: small
                                      - field:
                                        control: checkgrid
                                        frame: none
                                        max: 6
                                        depth: 2

                  - section: "_{Armour Class}"
                    id: armour
                    contents:
                      - row:
                        contents:
                          - calc:
                            output:
                              field: ac
                              legend: "_{Armour Class}"
                              icon: ac
                              border: full
                              width: large
                              underlay: "_{AC}"
                              merge-top: true
                              eq: '10+%{DEX}+%{ac-proficiency}+%{armour-bonus}+%{ac-items}+%{ac-misc}'
                            inputs:
                              - span: 10 +
                              - field:
                                ref: "DEX"
                                underlay: "_{DEX}"
                                label: "_{DEX}"
                              - span: +
                              - field: ac-proficiency
                                control: proficiency
                                label: "_{Proficiency}"
                              - span: +
                              - field: armour-bonus
                                label: "_{Armour\nBonus}"
                              - span: +
                              - field: ac-items
                                label: "_{Items}"
                              - span: +
                              - field: ac-misc
                                label: "_{Misc}"
                                misc: true
                                optional: true
                      - row:
                        contents:
                          - field: temp-ac
                            temp: true
                            frame: none
                            border: full
                            underlay: "_{AC}"
                            prefix: "+"
                            width: huge
                          - zone: '@temp-ac'
                          - spacer:

                          - field: unarmoured-proficiency
                            control: proficiency
                            frame: right
                            has-bonus: false
                            border: none
                            label: "_{Unarmoured}"
                          - field: light-armour-proficiency
                            control: proficiency
                            frame: right
                            has-bonus: false
                            border: none
                            label: "_{Light}"
                          - field: medium-armour-proficiency
                            control: proficiency
                            frame: right
                            has-bonus: false
                            border: none
                            label: "_{Medium}"
                          - field: heavy-armour-proficiency
                            control: proficiency
                            frame: right
                            has-bonus: false
                            border: none
                            label: "_{Heavy}"
                      - layout: 2e
                        contents:
                          - g:
                            merge-bottom: true
                            contents:
                              - hr:
                              - field: armour
                                legend: "_{Armour}"
                                size: large
                                width: stretch
                                flex: none
                                icon: ac
                              - slots:
                                min: 5
                                reduce: 1
                                contents:
                                  - zone: '@ac-conditional'
                                placeholder:
                                  - field: "ac-conditional-#{i}"
                                    frame: none
                                    width: stretch

                          - g:
                            contents:
                              - hr:
                              - field: shield
                                legend: "_{Shield}"
                                size: large
                                width: stretch
                                flex: none
                                icon: ac
                              - layout: indent-l
                                contents:
                                  - g:
                                  - row:
                                    contents:
                                      - action:
                                        contents:
                                          - p: "_{Raise shield}"
                                      - field: shield-ac
                                        label: "_{Shield Bonus}"
                                        # icon: ac
                                        border: full
                                        underlay: "_{AC}"
                                        prefix: "+"
                                        width: large
                              - selectable: 'raise-shield'
                                contents:
                                  - row:
                                    contents:
                                      - action: reaction
                                        contents:
                                          - row:
                                            contents:
                                              - p: "_{Shield block}"
                                      - field: shield-hardness
                                        label: "_{Hardness}"
                                        border: full
                                        suffix: "_{hp}"
                                        width: large
                                        blk: true
                                      - field: shield-hp
                                        label: "_{Shield Health}"
                                        border: full
                                        temp: true
                                        suffix: "_{hp}"
                                        width: large
                                        blk: true
                              - p: "_{Deduct hardness, then apply remaining damage to both shield and yourself.}"
                                optional: true

                  - tail:

              - g:
                contents:

                  - section: "_{Saving Throws}"
                    id: saving-throws
                    contents:
                      - table:
                        width: stretch
                        columns:
                          -
                          -
                          - "_{Ability\nModifier}"
                          - "_{Proficiency}"
                          - "_{Item}"
                          - "_{Misc}"
                        rows:
                          - save: fortitude
                            legend: "_{Fortitude}"
                            short: "_{FORT}"
                            ability: "_{CON}"
                            abilityref: CON
                          - save: reflex
                            legend: "_{Reflex}"
                            short: "_{REF}"
                            ability: "_{DEX}"
                            abilityref: DEX
                          - save: will
                            legend: "_{Will}"
                            short: "_{WILL}"
                            ability: "_{WIS}"
                            abilityref: WIS
                        template:
                          - calc:
                            output:
                              field: "#{save}"
                              legend: "#{legend}"
                              icon: bonus
                              border: full
                              width: large
                              underlay: "#{short}"
                              merge-top: true
                              eq: '%{#{abilityref}}+%{#{save}-proficiency}+%{#{save}-item-bonus}+%{#{save}-misc}'
                            inputs:
                              - field:
                                frame: h-label
                                label: "#{ability}"
                                underlay: "#{ability}"
                                ref: "#{abilityref}"
                              - field: "#{save}-proficiency"
                                control: proficiency
                              - field: "#{save}-item-bonus"
                              - field: "#{save}-misc"
                                misc: true
                      - indent:
                        contents:
                          - p: "_{Save DC = 10 + Save Bonus}"
                      - slots:
                        min: 5
                        reduce: 1
                        merge-bottom: true
                        contents:
                          - zone: '@saving-throws'
                        placeholder:
                          - field: 'saving-throws-conditional-#{i}'
                            frame: none
                            align: left
                            width: stretch

                  - section: "_{Focus}"
                    flex: small
                    contents:
                      - row:
                        contents:
                          - calc:
                            output:
                              field: focus
                              suffix: "_{pts}"
                              width: large
                              legend: "_{Focus}"
                            inputs:
                              - join: '+'
                                contents:
                                  - zone: '@focus-points'
                                    contents:
                                      - field: focus-base
                                        label: "_{Class}"
                                  - field: focus-misc
                                    label: "_{Misc}"
                                    misc: true
                          # - p: "Maximum focus: 3"
                          - spacer:
                          - field: current-focus
                            temp: true
                            label: "_{Current Focus Points}"
                            align: center
                            width: huge
                            border: full
                            suffix: "_{pts}"

                      - row:
                        contents:
                          - calc:
                            output:
                              field: focus-level
                              legend: "_{Focus\nLevel}"
                              width: large
                            inputs:
                              - ruby-round-up:
                                contents:
                                  - field:
                                    ref: level
                                    label: "_{Level}"
                                  - span: "&divide; 2"

                          - spacer:
                          - field: refocus
                            label: "_{Refocus}"
                            border: full
                            width: large
                            prefix: "+"
                            underlay: "1"
                            suffix: "_{pts}"
                  - tail:

      - page: feats
        order: 7
        flex: true
        contents:
          - layout: 2e
            contents:
              - g:
                contents:
                  - section: "_{Ancestry}"
                    contents:
                      - list:
                        hr: true
                        contents:
                          - g:
                            flex: tiny
                            contents:
                              - field: ancestry
                                size: huge
                                width: stretch
                                frame: none
                                merge-bottom: true
                                flex: tiny
                          - g:
                            contents:
                              - list:
                                hr: true
                                zebra: true
                                columns: 2
                                contents:
                                  - zone: '@heritage'
                                    contents:
                                      - article: heritage
                                        lines: 2
                                        annotation: "_{Heritage}"
                                  - each:
                                    template:
                                      - level: '#{level}'
                                        contents:
                                          - item: yes
                                    contents:
                                      - slots: [ 1, 5, 9, 13, 17 ]
                                        min: 1
                                        max: 1
                                        contents:
                                          - zone: '@ancestry-feats'
                                        placeholder:
                                          - article: 'ancestry-feat-#{i}'
                                            lines: 2

                  - section: '_{Advancement}'
                    flex: none
                    contents:
                      - list:
                        hr: true
                        contents:
                          - advancement:
                            advances:
                              - levels: [ 1, 5, 9, 13, 17 ]
                                ancestry-feat: true
                              - levels: [ 3, 7, 11, 15, 19 ]
                                general-feat: true
                              - levels: [ 2, 4, 6, 8, 10, 12, 14, 16, 18, 20 ]
                                class-feat: true
                              - levels: [ 2, 4, 6, 8, 10, 12, 14, 16, 18, 20 ]
                                skill-feat: true
                              - levels: [ 3, 5, 7, 9, 11, 13, 15, 17, 19 ]
                                skill-increase: true
                              - levels: [ 5, 10, 15, 20 ]
                                gain: "_{Ability boost}"
                              - level: 7
                                advance: "_{Master in skills}"
                              - level: 15
                                advance: "_{Legendary in skills}"
                              - zone: '@advancement'
                            fields:
                              - zone: '@advancement-fields'
                              - name: "_{Ancestry\nfeat}"
                                key: ancestry-feat
                              - name: "_{General\nfeat}"
                                key: general-feat
                              - name: "_{Class\nfeat}"
                                key: class-feat
                              - name: "_{Skill\nfeat}"
                                key: skill-feat
                              - name: "_{Skill\nincrease}"
                                key: skill-increase

                          - g:
                            contents:
                              - h5: "_{Proficiencies}"
                              - list:
                                zebra: true
                                collapse: true
                                merge-bottom: true
                                columns: 2
                                field_frame: none
                                contents:
                                  - repeat: 12
                                    reduce: 2
                                    contents:
                                      - row:
                                        contents:
                                          - field: "proficiency-#{i}-value"
                                            control: icon
                                            icon: proficiency
                                          - field: "proficiency-#{i}-name"
                                            frame: none
                                            width: stretch
                                            align: left
                  - tail:
                  - spacer:

              - g:
                contents:
                  - section: "_{General Feats}"
                    flex: small
                    contents:
                      - list:
                        columns: 2
                        zebra: true
                        hr: true
                        contents:
                          - each:
                            template:
                              - level: "#{level}"
                                contents:
                                  - item: yes
                            contents:
                              - slots: [ 3, 7, 11, 15, 19 ]
                                min: 1
                                max: 1
                                placeholder:
                                  article: general-feat-level-#{level}
                                  lines: 2
                                contents:
                                  - zone: '@general-feats'
                          - zone: '@general-feat-bonus'
                            contents:
                              - article: general-feat-bonus
                                lines: 2
                                annotation: "_{Bonus}"

                  - section: "_{Skill Feats}"
                    flex: large
                    contents:
                      - zone: '@skill-feats-section'
                        contents:
                          - list:
                            hr: true
                            contents:
                              - list:
                                zebra: true
                                columns: 2
                                flex: huge
                                hr: true
                                contents:
                                  - article: 'skill-feat-#{level}'
                                    lines: 2
                                    annotation: "_{Background}"
                                  - each:
                                    template:
                                      - level: "#{level}"
                                        contents:
                                          - item: yes
                                    contents:
                                      - slots: [ 2, 4, 6, 8, 10, 12, 14, 16, 18, 20 ]
                                        min: 1
                                        max: 1
                                        placeholder:
                                          article: 'skill-feat-#{level}'
                                          lines: 2
                                        contents:
                                          - zone: '@skill-feats'
                                  - article: skill-feat-bonus
                                    lines: 2
                                    annotation: "_{Bonus}"

                              - g:
                                contents:
                                  - h5: "_{Notes}"
                                  - layout: 2e
                                    contents:
                                      - repeat: 2
                                        contents:
                                          - field: skill-notes-#{i}
                                            flex: small
                                            width: stretch
                                            frame: none
                                            repeat: 14
                                            reduce: 2
                                            merge-bottom: true

                  - tail:
                  # - spacer:
