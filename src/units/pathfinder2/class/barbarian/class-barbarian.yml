unit: class/barbarian
in: class
group: "_{Core Rulebook}"
name: "_{Barbarian}"

form:
  - option: barbarian-instinct
    name: "_{Instinct}"
    max: 1

require:
  - unit: weapon-spec/fast
  
inc:
  - set: class
    value: "_{Barbarian}"
  - set: hp-class
    value: 12
  - set: class-dc-proficiency
    value: trained
  - set: perception-proficiency
    value: expert
  - set: fortitude-proficiency
    value: expert
  - set: reflex-proficiency
    value: trained
  - set: will-proficiency
    value: expert
  - set: athletics-proficiency
    value: trained

  - at: '@cover-class'
    replace:
      - h6: "_{Barbarian}"
      - field: barbarian-instinct
        label: "Instinct"
        width: stretch
        align: left

  - at: '@key-ability-field'
    replace:
      - field:
        label: "_{STR}"
        underlay: "_{STR}"
        ref: STR

  - at: '@pages'
    add:
      - page: barbarian
        name: "_{Barbarian}"
        # flex: true
        order: 10
        contents:
          - layout: 2l
            contents:
            - g:
              contents:
                - class-icon: barbarian
                  optional: true
                - h2: "_{Barbarian}"
                - section: "_{Totem}"
                  primary: true
                  contents:
                    - article:
                      header:
                        - field: barbarian-totem
                          legend: "_{Totem}"
                          width: stretch
                          align: left
                      contents:
                        - field: barbarian-totem-anathema
                          label: "_{Anathema}"
                          width: stretch
                          align: left
                          repeat: 4
                          reduce: 2
                          merge-bottom: true
                        - hr:
                        - field: barbarian-totem-ability
                          label: "_{Totem Ability}"
                          width: stretch
                          align: left
                          repeat: 4
                          reduce: 2
                          merge-bottom: true
                        - hr:
                        - field: barbarian-totem-raging-resistance
                          label: "_{Raging Resistance}"
                          width: stretch
                          align: left
                          repeat: 4
                          reduce: 2
                          merge-bottom: true
                - section: "_{Deny Advantage}"
                  contents:
                    - level: 5
                      contents:
                        - p: "_{Never flat-footed against creatures of a lower level.}"
                - section: "_{Juggernaut}"
                  contents:
                    - level: 7
                      contents:
                        - type: proficiency
                          proficiency: master
                          content: Master at Fortitude saves
                        - type: p
                          content: "_{When you succeed at a Fortitude save, treat it as a critical success.}"
                    - hr:
                    - level: 13
                      contents:
                        - type: proficiency
                          proficiency: legendary
                          content: "_{Legendary at Fortitude saves}"
                        - p: "_{When you critically fail a Fortitude save, treat it as a failure. When you fail a Fortitude save against an effect that deals damage, you halve the damage you take.}"
                - section: "_{Weapon Fury}"
                  contents:
                  - level: 13
                    contents:
                    - type: proficiency
                      proficiency: expert
                      content: "_{Expert at simple and martial weapons, and unarmed attacks}"
                - section: "_{Indomitable Will}"
                  contents:
                  - level: 15
                    contents:
                    - type: proficiency
                      proficiency: master
                      content: "_{Master at Will saves}"
                    - p: "_{When you succeed at a Will save, treat it as a critical success.}"
                - section: "_{Devastating Strikes}"
                  contents:
                    - level: 19
                      contents:
                        - calc:
                          output:
                            field: barbarian-raging-resistance-
                            legend: "_{Resistance Reduction}"
                          inputs:
                            - field:
                              ref: CON
                              underlay: "_{CON}"
                              label: "_{CON}"
                            - span: "&times; 2"
                        - p: "_{If you succeed at a melee Strike against a target with resistance against the physical damage type of the weapon or unarmed attack you’re using, reduce that resistance.}"
                - tail:
            - g:
              contents:
                - section: "_{Rage}"
                  contents:
                    - list:
                      hr: true
                      contents:
                        - zone: '@barbarian-rage'
                          contents:
                            - action:
                              contents:
                                - row:
                                  contents:
                                    - field: rage-rounds
                                      legend: "_{Rage Rounds}"
                                      control: progression
                                      parts:
                                        - control: checkbox
                                        - control: checkbox
                                        - control: checkbox
                                    - spacer:
                                    - p: "_{After raging, you are fatigued for 1 round.}"
                                    - spacer:
                                - p: "_{While raging, cannot use actions that require concentration, except for Seek.}"
                                - row:
                                  contents:
                                    - field: barbarian-rage-damage-bonus
                                      output: true
                                      label: "_{Damage Bonus}"
                                      width: large
                                    - p: "_{To melee and unarmed strikes}"
                                    - spacer:
                                    - field: barbarian-rage-ac-penalty
                                      label: "_{AC Penalty}"
                                      output: true
                                      width: large
                                      value: "-1"
                                    - spacer:
                                    - calc:
                                      output:
                                        field: barbarian-rage-temp-hp
                                        label: "_{Temporary Hit Points}"
                                        overlay: hp
                                        temp: true
                                      inputs:
                                        - field:
                                          ref: CON
                                          underlay: "_{CON}"
                                          label: "_{CON}"
                                        - span: "+"
                                        - field:
                                          ref: level
                                          label: "_{Level}"
                            - level: 3
                              contents:
                                - h5: "_{Critical Brutality}"
                                - p: "_{Gain critical specialization for your melee weapon or unarmed attack.}"
                            - level: 9
                              contents:
                                - row:
                                  contents:
                                    - calc:
                                      output:
                                        field: barbarian-raging-resistance
                                        legend: "_{Raging Resistance}"
                                        width: large
                                      inputs:
                                        - field:
                                          ref: CON
                                          underlay: "_{CON}"
                                          label: "_{CON}"
                            - level: 11
                              contents:
                                - action: free
                                  contents:
                                    - h5: "_{Mighty Rage}"
                                    - p: "_{Use one of your rage actions as a free action.}"
                            - level: 17
                              contents:
                                - h5: "_{Tireless Rage}"
                                - p: "_{Don’t become fatigued after you stop raging. It still takes the normal amount of time before you can use Rage again.}"
                - section: "_{Barbarian Feats}"
                  contents:
                    - list:
                      zebra: true
                      columns: 2
                      flowv: true
                      hr: true
                      contents:
                        - repeat: 12
                          rows:
                            - level: 1
                            - level: 2
                            - level: 4
                            - level: 6
                            - level: 8
                            - level: 10
                            - level: 12
                            - level: 14
                            - level: 16
                            - level: 18
                            - level: 20
                            - level: " "
                          contents:
                            - level: "#{level}"
                              contents:
                                - article:
                                  header:
                                    - field: barbarian-feat-level-#{level}
                                      width: stretch
                                      frame: none
                                      align: left
                                  contents:
                                    - field: barbarian-feat-level-#{level}-details
                                      width: stretch
                                      align: left
                                      frame: none
                                      repeat: 3
                                      reduce: 1
                - tail:

