unit: class/monk
in: class
group: "_{Core Rulebook}"
name: "_{Monk}"

form:
  - select: monk/stance
    name: "_{Monk Stance}"
    max: 1
  - select: feat/monk
    name: "_{Monk Feats}"
    max: 8
    levels: [ 2, 4, 6, 8, 10, 14, 16, 18, 20 ]

inc:
  - set: class
    value: "_{Monk}"
  - set: class-dc-proficiency
    value: trained
  - set: perception-proficiency
    value: trained
  - set: fortitude-proficiency
    value: expert
  - set: reflex-proficiency
    value: expert
  - set: will-proficiency
    value: expert
  

  - at: '@cover-class'
    replace:
      - h6: "_{Monk}"
      - field: monk-stance
        label: "_{Stance}"
        width: stretch
        align: left

  - at: '@actions'
    add:
      - action: 1
        contents:
          - article:
            header:
              - h5: "_{Flurry of Blows}"
            contents:
              - p: "_{Make two unarmed Strikes. If both hit the same creature, combine their damage and enhancements.}"

  - at: '@focus-points'
    replace:
      - field: monk-ki-spells-focus
        label: "_{Ki Spells}"

  - at: '@pages'
    add:
      - page: monk
        name: "_{Monk}"
        flex: true
        order: 10
        contents:
          - layout: 2l
            contents:
              - g:
                contents:
                  - class-icon: monk
                  - h2: "_{Monk}"

                  - section: "_{Unarmed}"
                    contents:
                      - list:
                        hr: true
                        zebra: true
                        avoid-shade: true
                        contents:
                          - zone: '@monk-unarmed'
                            contents:
                              - article:
                                header:
                                  - h5: "_{Powerful Fist}"
                                contents:
                                  - p: "_{When striking with your fist, deal 1d6 damage instead of 1d4.}"
                                  - p: "_{Don't take the -2 penalty when making a lethal attack with a nonlethal unarmed attack.}"
                              - level: 3
                                contents:
                                  - article:
                                    header:
                                      - h5: "_{Mystic Strikes}"
                                    contents:
                                      - p: "_{Your unarmed attacks become magical, allowing them to bypass resistances.}"
                              - level: 9
                                contents:
                                  - article:
                                    header:
                                      - h5: "_{Metal Strikes}"
                                    contents:
                                      - p: "_{Your unarmed attacks are treated as cold iron and silver.}"
                              - level: 17
                                contents:
                                  - article:
                                    header:
                                      - h5: "_{Adamantine Strikes}"
                                    contents:
                                      - p: "_{Your unarmed attacks are treated as adamantine.}"

                  - section: "_{Ki Spells}"
                    contents:
                      - selectable: ki-spells
                        contents:
                          - calc:
                            output:
                              field: ki-spell-attack
                              legend: "_{Ki Spell\nAttack}"
                              icon: bonus
                            inputs:
                              - join: "+"
                                contents:
                                  - field:
                                    label: "_{WIS}"
                                    ref: WIS
                                    underlay: "_{WIS}"
                                  - field: ki-spell-proficiency
                                    control: proficiency
                                    label: "_{Proficiency}"
                                  - field: ki-spell-save-misc
                                    label: "_{Misc}"
                                    misc: true
                          - calc:
                            output:
                              field: ki-spell-save-dc
                              legend: "_{Ki Spell\nSave DC}"
                              icon: dc
                            inputs:
                              - join: "+"
                                contents:
                                  - span: "10"
                                  - field:
                                    label: "_{WIS}"
                                    ref: WIS
                                    underlay: "_{WIS}"
                                  - field: ki-spell-proficiency
                                    control: proficiency
                                    label: "_{Proficiency}"
                                  - field: ki-spell-save-misc
                                    label: "_{Misc}"
                                    misc: true
                      # - field: 'ki-spells'
                      #   width: stretch
                      #   frame: none
                      #   repeat: 2
                      #   merge-bottom: true

                  - section: "_{Incredible Movement}"
                    contents:
                      - list:
                        zebra: true
                        hr: true
                        contents:
                          - zone: '@monk-incredible-movement'
                            contents:
                              - g:
                                contents:
                                  - table:
                                    flip: true
                                    rows:
                                      - level: 3
                                        speed: "+10ft"
                                      - level: 7
                                        speed: "+15ft"
                                      - level: 11
                                        speed: "+20ft"
                                      - level: 15
                                        speed: "+25ft"
                                      - level: 19
                                        speed: "+30ft"
                                    template:
                                      - level-marker: '#{level}'
                                      - span: '#{speed}'
                                  - p: "_{Bonus to Speed when not wearing armor.}"

                  - section: "_{Path to Perfection}"
                    contents:
                      - list:
                        zebra: true
                        hr: true
                        contents:
                          - zone: '@monk-path-to-perfection'
                            contents:
                              - level: 7
                                contents:
                                  - proficiency: master
                                    contents:
                                      - article:
                                        header:
                                          h5: "_{Path to Perfection}"
                                        contents:
                                              - p: "_{Become master in one saving throw.}"
                              - level: 11
                                contents:
                                  - proficiency: master
                                    contents:
                                      - article:
                                        header:
                                          h5: "_{Second Path to Perfection}"
                                        contents:
                                              - p: "_{Become master in a second saving throw.}"
                                              - p: "_{If you succeed at this saving throw, you instead critically succeed.}"
                              - level:  15
                                contents:
                                  - proficiency: legendary
                                    contents:
                                      - article:
                                        header:
                                          h5: "_{Third Path to Perfection}"
                                        contents:
                                              - p: "_{Become legendary in one of the above two saving throws.}"
                                              - p: "_{If you critical fail at this saving throw, you fail instead.}"

                  - section: "_{Perfected Form}"
                    contents:
                      - level: 19
                        contents:
                          - p: "_{On the first attack of your turn, any roll below 10 becomes 10.}"

                  - tail:
                  # - spacer:

              - g:
                contents:
                  - zone: '@monk-stance'
                    contents:
                      - section: "_{Stance}"
                        primary: true
                        contents:
                          - list:
                            zebra: true
                            hr: true
                            contents:
                              - selectable:
                                contents:
                                  - action:
                                    contents:
                                      - article:
                                        header:
                                          - field: stance
                                            size: large
                                            width: stretch
                                            align: left
                                            frame: none
                                        contents:
                                          - field: stance-details
                                            frame: none
                                            width: stretch
                                            align: left
                                            repeat: 3
                              - selectable:
                                contents:
                                  - article:
                                    header:
                                      - field: stance-2
                                        size: large
                                        width: stretch
                                        align: left
                                        frame: none
                                    contents:
                                      - field: stance-2
                                        frame: none
                                        width: stretch
                                        align: left
                                        repeat: 3

                  - section: "_{Flurry of Blows}"
                    contents:
                      - list:
                        hr: true
                        zebra: true
                        avoid-shade: true
                        contents:
                          - zone: '@monk-flurry-of-blows'
                            contents:
                              - action: 1
                                contents:
                                  - article:
                                    header:
                                      - h5: "_{Flurry of Blows}"
                                    contents:
                                      - p: "_{Once per round, make two unarmed Strikes. If both hit the same creature, combine their damage and enhancements for the purpose of resistances and weaknesses.}"
                              - level: 9
                                contents:
                                  - article:
                                    header:
                                      - h5: "_{Fierce Flurry}"
                                    contents:
                                      - p: "_{If you hit with both Strikes in a Flurry of Blows, increase the weapon damage dice of each attack by one step.}"
                              - level: 19
                                contents:
                                  - article:
                                    header:
                                      - h5: "_{Perfected Form}"
                                    contents:
                                      - p: "_{When you make an unarmed Strike, you can treat any dice whose roll was lower than 10 as if you had rolled a 10. If you do, your Strike gains the fortune trait.}"

                  - section: "_{Monk Feats}"
                    contents:
                      - list:
                        zebra: true
                        columns: 2
                        flowv: true
                        hr: true
                        contents:
                          - each:
                            template:
                              - level: "#{level}"
                                contents:
                                  - item:
                            contents:
                              - slots: [ 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, '' ]
                                min: 1
                                max: 1
                                placeholder:
                                  article:
                                  header:
                                    - field: monk-feat-level-#{level}
                                      width: stretch
                                      frame: none
                                      align: left
                                  contents:
                                    - field: monk-feat-level-#{level}-details
                                      width: stretch
                                      align: left
                                      frame: none
                                      repeat: 2
                                contents:
                                  - zone: '@monk-feats'
                  - tail:
                  - spacer:
