unit: class/cleric
in: class
group: "_{Core Rulebook}"
name: "_{Cleric}"

form:
  - select: cleric/doctrine
    name: "_{Doctrine}"
    max: 1
  - select: cleric/domain
    name: "_{Domain}"
    max: 1
  - select: feat/cleric
    name: "_{Cleric Feats}"
    max: 8
    levels:

require:
  - unit: weapon-spec/fast
  
inc:
  - at: '@key-ability-field'
    replace:
      - field:
        label: "_{WIS}"
        underlay: "_{WIS}"
        ref: WIS

  - at: '@pages'
    add:
      - page: cleric
        name: "_{Cleric}"
        flex: true
        order: 10
        contents:
          - layout: 2l
            contents:
              - g:
                contents:
                  - class-icon: box
                  - class-name: "_{Cleric}"
                    affix: "_{of}"
                  - field: cleric-deity
                    width: stretch
                    frame: none
                    align: center
                  - layout: alignment
                    contents:
                      - g:
                        contents:
                          - field: cleric-deity-weapon
                            label: "_{Favoured Weapon}"
                            width: stretch
                          - field: cleric-deity-anathema
                            label: "_{Anathema}"
                            width: stretch
                            repeat: 3
                            merge-bottom: true
                      - field: cleric-alignment
                        control: alignment
                  - section: "_{Doctrine}"
                    primary: true
                    contents:
                      - zone: '@cleric-doctrine'
                        contents:
                          - field: cleric-doctrine
                            frame: none
                            width: stretch
                            align: center
                            merge-bottom: true
                      - hr:
                      - list:
                        zebra: true
                        hr: true
                        contents:
                          - each:
                            template:
                              - level: '#{level}'
                                contents:
                                  - item:
                            contents:
                              - slots: [ 1, 3, 7, 11, 15, 19 ]
                                min: 1
                                contents:
                                  - zone: '@cleric-doctrine-abilities'
                                placeholder:
                                  - field: "cleric-doctrine-#{level}"
                                    width: stretch
                                    frame: none
                                    merge-bottom: true
                                    repeat: 2

                  - section: "_{Spells}"
                    contents:
                      - spells-table:
                        flip: true

                  - section: "_{Channel Energy}"
                    contents:
                      - row: center
                        contents:
                          - field: channel-energy
                            value: positive
                            frame: left
                            control: radio
                            label: "_{Positive}"
                          - icon: good
                          - span: "&nbsp;"
                          - icon: evil
                          - field: channel-energy
                            value: negative
                            frame: right
                            control: radio
                            label: "_{Negative}"
                      - hr:
                      - row: split
                        contents:
                          - calc:
                            output:
                              field: channel-energy-per-day
                              label: "_{Uses per day}"
                              width: huge
                            inputs:
                              - "3 +"
                              - field:
                                ref: CHA
                                underlay: "_{CHA}"
                          - field: channel-energy-today
                            label: "_{Used today}"
                            control: checkgrid
                            depth: 2
                            max: 12
                      - row: split
                        contents:
                          - calc:
                            output:
                              field: channel-energy-dmg
                              legend: "_{Healing /\nDamage}"
                              overlay: "d8"
                              width: huge
                            inputs:
                              - label: "_{Max\nSpell\nLevel}"
                          - spacer:
                          - field: channel-energy-range
                            label: "_{Range}"
                            border: full
                            width: large
                            value: "30"
                            overlay: "_{ft}"
                      - list:
                        hr: true
                        contents:
                          - action: 1
                            contents:
                              - p: "_{Touch one ally or enemy}"
                          - action: 2
                            contents:
                              - row: split
                                contents:
                                  - p: "_{All allies or all enemies in range}"
                          - action: 3
                            contents:
                              - p: "_{All allies and enemies in range}"

                  - tail:
                  - spacer:

              - g:
                contents:

                  - section: "_{Domain}"
                    primary: true
                    contents:
                      - field: cleric-domain
                        label: "_{Domain}"
                        width: stretch
                      - field: cleric-domain-summary
                        width: stretch
                        frame: none
                        repeat: 2
                        merge-bottom: true

                      - hr:
                      - layout: 2e
                        contents:
                          - article:
                            header:
                              - field: cleric-domain-power
                                legend: "_{Domain Power}"
                                width: stretch
                            contents:
                              - field: cleric-domain-power-detail
                                width: stretch
                                repeat: 2
                                frame: none
                          - article:
                            header:
                              - field: cleric-domain-advanced-power
                                legend: "_{Advanced Domain Power}"
                                width: stretch
                            contents:
                              - field: cleric-domain-advanced-power-detail
                                width: stretch
                                repeat: 2
                                frame: none

                  - section: "_{Cantrips}"
                    contents:
                      - spells-list:
                        min: 0
                        max: 0
                        spells: 5

                  - section: "_{Spells}"
                    contents:
                      - spells-list:
                        min: 1
                        max: 9
                        spells: 4
                        # special: "Domain"

                  - section: "_{Cleric Feats}"
                    contents:
                      - list:
                        zebra: true
                        columns: 2
                        flowv: true
                        hr: true
                        contents:
                          - each:
                            template:
                              - level: "#{level}"
                                contents:
                                  - item:
                            contents:
                              - slots: [ 2, 4, 6, 8, 10, 14, 16, 18, 20 ]
                                min: 1
                                max: 1
                                placeholder:
                                  article:
                                  header:
                                    - field: cleric-feat-level-#{level}
                                      width: stretch
                                      frame: none
                                      align: left
                                  contents:
                                    - field: cleric-feat-level-#{level}-details
                                      width: stretch
                                      align: left
                                      frame: none
                                      repeat: 2
                                contents:
                                  - zone: '@cleric-feats'
                  - tail:
                  - spacer:
