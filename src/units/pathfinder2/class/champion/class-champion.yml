unit: class/champion
in: class
group: "Core Rulebook"
name: "_{Champion}"

form:
  - select: champion/cause
    name: "_{Champion's Cause}"
    max: 1

require:
  - unit: weapon-spec/fast
  - unit: feat/shield-block

inc:
  - set: class
    value: "_{Champion}"
  - set: hp-class
    value: 10
  - set: champion-cause-name
    value: "_{Cause}"
    
  - set: class-dc-proficiency
    value: trained
  - set: divine-spell-proficiency
    value: trained
  - set: perception-proficiency
    value: trained
  - set: fortitude-proficiency
    value: expert
  - set: reflex-proficiency
    value: trained
  - set: will-proficiency
    value: expert
  - set: religion-proficiency
    value: trained

  - at: '@advancement'
    add:
      - level: 1
        class-feat: true
      - level: 3
        advance: "_{Divine Ally}"
      - level: 9
        advance: "_{Divine Smite}"
      - level: 11
        advance: "_{Exalt}"
      - level: 19
        advance: "_{Hero's Defiance}"

  - at: '@focus-points'
    replace:
      - field: champion-devotion-spells-focus
        label: "_{Devotion\nSpells}"
        underlay: "1"

  - at: '@saving-throws'
    add:
      - level: 9
        contents:
          - paste: juggernaut
      - level: 11
        contents:
          - paste: divine-will

  - at: '@pages'
    add:
      - page: champion
        order: 10
        flex: true
        contents:
          - layout: 2l
            contents:
              - g:
                contents:
                  - class-icon: box
                  - zone: '@champion-class-name'
                    contents:
                      - class-name: ''
                        preface: "_{Champion}"
                        suffix: "_{of}"
                  - field: cleric-deity
                    width: stretch
                    frame: none
                    align: center

                  - section: "_{Deific Weapon}"
                    contents:
                      - row:
                        contents:
                          - field: champion-deific-weapon
                            label: "_{Favoured Weapon}"
                            width: stretch
                          - field: champion-deific-weapon-die
                            label: "_{Weapon Die}"
                            prefix: "_{d}"

                  - zone: '@champion-reaction-section'
                    contents:
                      - section: "_{Champion's Reaction}"
                        contents:
                          - list:
                            hr: true
                            contents:
                              - action: reaction
                                contents:
                                  - article: 
                                    lines: 3
                              - level: 9
                                contents:
                                  - h5: "_{Divine Smite}"
                                  - article:
                                    lines: 3
                              - level: 11
                                contents:
                                  - h5: "_{Exalt}"
                                  - article:
                                    lines: 3

                  - section: "_{Shield Block}"
                    contents:
                      - action: reaction
                        contents:
                          - p: "_{While you have your shield raised, you can use it to absorb damage.}"

                  - section: "_{Divine Ally}"
                    contents:
                      - level: 3
                        contents:
                          - list:
                            hr: true
                            contents:
                              - selectable: champion-blade-ally
                                contents:
                                  - h5: "_{Blade Ally}"
                                  - row:
                                    contents:
                                      - field: champion-blade-ally-weapon
                                        label: "_{Weapon}"
                                        width: stretch
                                      - field: champion-blade-ally-rune
                                        label: "Rune"
                                        width: stretch
                              - selectable: champion-shield-ally
                                contents:
                                  - h5: "_{Shield Ally}"
                                  - row:
                                    contents:
                                      - field:
                                        control: value
                                        label: "_{Hardness}"
                                        value: "+2"
                                      - field:
                                        label: "_{Shield\nHit Points}"
                                        suffix: "hp"
                                      - field:
                                        label: "_{Broken\nThreshold}"
                                        suffix: "hp"
                              - selectable: champion-steed-ally
                                contents:
                                  - h5: "_{Steed}"
                                  - field: champion-steed-ally-mount
                                    width: stretch

                  - tail:
                  - spacer:

              - g:
                contents:

                  - zone: '@champion-cause-section'
                    contents:
                      - section: "_{Cause}"
                        primary: true
                        contents:
                          - list:
                            contents:
                              - layout: alignment
                                contents:
                                  - g:
                                    contents:
                                      - field: cause
                                        width: stretch
                                        size: large
                                        frame: none
                                      - field: cause-detail
                                        width: stretch
                                        frame: none
                                  - field: cause-alignment
                                    control: alignment
                                    frame: none
                              - g:
                                contents:
                                  - h5: "_{Tenets}"
                                  - field: champion-tenets
                                    width: stretch
                                    repeat: 5
                                  - h5: "_{Anathema}"
                                  - paste: anathema
                                  # - field: anathema
                                  #   width: stretch
                                  #   repeat: 3
                                  - p: "_{If you violate your code of conduct, you lose your focus pool and divine ally until you demonstrate repentance.}"

                  - section: "_{Devotion Spells}"
                    contents:
                      - list:
                        hr: true
                        zebra: true
                        avoid-shade: true
                        contents:
                          - row:
                            contents:
                              - calc:
                                output:
                                  field: divine-spell-attack
                                  label: "_{Divine Spell\nAttack}"
                                  width: large
                                  icon: bonus
                                inputs:
                                  - field: key-ability
                                    label: "Key\nAbility"
                                    misc: true
                                    ref: true
                                  - field: divine-spell-proficiency
                                    control: proficiency
                                    label: "Proficiency"
                              - calc:
                                output:
                                  field: divine-spell-dc
                                  label: "_{Divine Spell\nDC}"
                                  underlay: "_{DC}"
                                  width: large
                                  icon: dc
                                inputs:
                                  - span: "10 +"
                                  - field: key-ability
                                    label: "Key\nAbility"
                                    misc: true
                                    ref: true
                                  - field: divine-spell-proficiency
                                    control: proficiency
                                    label: "Proficiency"

                      - slots:
                        min: 1
                        contents:
                          - zone: '@champion-devotion-spells'
                        placeholder:
                          section: "_{Devotion Spell}"
                          contents:
                            - article:
                              line: 2

                      - section: "_{Hero's Defiance}"
                        contents:
                          - level: 19
                            contents:
                              - action: free
                                contents:
                                  - layout: indent-r
                                    contents:
                                      - p: "_{On being reduced to 0hp, recover 10d4+20 hp.}"
                                      - level-marker:
                                        marker: "Focus"
                                        level: "1pt"

                  - paste: class-feats
                    params:
                      id: champion-feats
                      title: "_{Champion Feats}"
                      slots: [ 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20 ]

                  - tail:
