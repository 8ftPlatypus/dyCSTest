unit: class/rogue
in: class
group: "Core Rulebook"
name: "_{Rogue}"

form:
  - select: rogue/racket
    name: "_{Rogue's Racket}"
    max: 1
  - select: feat/rogue
    name: "_{Rogue Feats}"
    max: 8
    levels: [ 2, 4, 6, 8, 10, 14, 16, 18, 20 ]

require:
  - unit: weapon-spec/fast

inc:
  - set: class
    value: "_{Rogue}"
  - set: class-dc-proficiency
    value: trained
  - set: stealth-proficiency
    value: trained
  - set: perception-proficiency
    value: expert
  - set: fortitude-proficiency
    value: trained
  - set: reflex-proficiency
    value: expert
  - set: will-proficiency
    value: expert

  - at: '@skill-feats-section'
    replace:
      - list:
        zebra: true
        hr: true
        avoid-shade: true
        contents:
          - article: 'skill-feat-#{level}'
            lines: 1
            annotation: "_{Background}"
          - each:
            template:
              - level: "#{level}"
                contents:
                  - item: yes
            contents:
              - slots: [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20 ]
                min: 1
                max: 1
                placeholder:
                  article: 'skill-feat-#{level}'
                  lines: 1
                contents:
                  - zone: '@skill-feats'
      - tail:

  - at: '@field-class-hp'
    replace:
      - field: hp-class
        label: "_{Class}"
        border: none
        value: "8"

  - at: '@language-section'
    replace:
      - nothing:

  - at: '@proficiencies'
    replace:
      - nothing:

  - at: '@advancement'
    add:
      - levels: [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20 ]
        skill-feat: true
      - levels: [ 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20 ]
        skill-increase: true
      - level: 1
        advance: "_{Racket}"
      - levels: [ 1, 5, 11, 17 ]
        sneak-attack: [ "_{1d6}", "_{2d6}", "_{3d6}", "_{4d6}" ]
      - level: 3
        advance: "_{Deny Advantage}"
      - level: 5
        proficiency: expert
        in: "_{Simple weapons, rapier, sap, shortbow, shortsword}"
      - level: 9
        advance: "_{Debilitating Strike}"
      - level: 13
        advance: "_{Master Tricks}"
      - level: 20
        advance: "_{Master Strike}"

  - at: '@advancement-fields'
    add:
      - name: "_{Sneak\nAttack}"
        key: sneak-attack
        format: string

  - at: '@pages'
    add:
      - page: rogue
        name: "_{Rogue}"
        flex: true
        order: 10
        contents:
          - layout: 2l
            contents:
              - g:
                contents:
                  - class-icon: rogue
                  - h2: "_{Rogue}"

                  - section: "_{Class DC}"
                    id: class-dc
                    contents:
                      - calc:
                        output:
                          field: class-dc
                          legend: "Rogue\nClass DC"
                          underlay: "_{DC}"
                          width: large
                          icon: dc
                          eq: '%{#{key-ability}}+%{level}+%{class-dc-item-bonus}'
                        inputs:
                          - zone: '@key-ability-field'
                            contents:
                              - field:
                                label: "_{Key\nAbility}"
                                ref: key-ability
                          - span: "+"
                          - field: class-dc-proficiency
                            label: "_{Proficiency}"
                            control: proficiency
                          - span: "+"
                          - field: class-dc-item-bonus
                            label: "_{Item}"

                  - section: "_{Sneak Attack}"
                    contents:
                      - list:
                        hr: true
                        zebra: true
                        avoid-shade: true
                        contents:
                          - g:
                            contents:
                              - row:
                                contents:
                                  - field: sneak-attack-dmg
                                    legend: "_{Sneak Attack\nDamage Bonus}"
                                    icon: damage
                                    width: large
                                    border: full
                                    overlay: "_{d6}"
                                  - p: "_{Precision damage}"
                                  - spacer:
                              - p: "_{When you attack a flat-footed opponent with an agile or finesse weapon/unarmed strike, or a ranged weapon.}"
                          - g:
                            contents:
                              - h5: "_{Surprise Attack}"
                              - p: "_{On the first round of combat, if you roll Decpetion or Stealth for initiative, creatures that haven't acted yet are flat-footed.}"

                  - section: "_{Deny Advantage}"
                    contents:
                      - level: 3
                        contents:
                          - p: "_{Not flat-footed to hidden, undetected or flanking creatures, or surprise attacks by creatures up to your level.}"

                  - section: "_{Weapon Tricks}"
                    contents:
                      - list:
                        hr: true
                        contents:
                          - level: 5
                            contents:
                              - p: "_{When you make a critical hit with a suitable weapon, apply the weapon's critical specialisation effect.}"

                  - section: "_{Evasion}"
                    contents:
                      - level: 7
                        contents:
                          - p: "_{Success becomes critical success on Reflex saves.}"

                  - section: "_{Weapon Specialisation}"
                    contents:
                      - level: 7
                        contents:
                          - h5: "_{Damage Bonus}"
                          - layout: 3e
                            contents:
                              - row:
                                contents:
                                  - icon: proficiency-expert
                                  - field:
                                    border: full
                                    frame: none
                                    value: "+2"
                              - row:
                                contents:
                                  - icon: proficiency-master
                                  - field:
                                    border: full
                                    frame: none
                                    value: "+3"
                              - row:
                                contents:
                                  - icon: proficiency-legendary
                                  - field:
                                    border: full
                                    frame: none
                                    value: "+4"

                      - hr:
                      - level: 15
                        contents:
                          - h5: "_{Greater Weapon Specialisation}"
                          - layout: 3e
                            contents:
                              - row:
                                contents:
                                  - icon: proficiency-expert
                                  - field:
                                    border: full
                                    frame: none
                                    value: "+4"
                              - row:
                                contents:
                                  - icon: proficiency-master
                                  - field:
                                    border: full
                                    frame: none
                                    value: "+6"
                              - row:
                                contents:
                                  - icon: proficiency-legendary
                                  - field:
                                    border: full
                                    frame: none
                                    value: "+8"

                  - section: "_{Debilitating Strike}"
                    contents:
                      - list:
                        hr: true
                        zebra: true
                        avoid-shade: true
                        contents:
                          - level: 9
                            contents:
                              - p: "_{On hitting a flat-footed target, inflict an effect until the end of your next turn:}"
                              - ul:
                                contents:
                                  - li: "_{-10ft to target's speed}"
                                  - li: "_{Target is enfeebled 1}"
                          - level: 15
                            contents:
                              - h5: "_{Double Debilitation}"
                              - p: "_{Apply two effects.}"

                  - section: "_{Slippery Mind}"
                    contents:
                      - level: 17
                        contents:
                          - p: "_{Success becomes critical success on Will saves.}"

                  - section: "_{Master Strike}"
                    contents:
                      - level: 19
                        contents:
                          - p: "_{When your strike hits a flat-footed creature and deals damage, they must also attempt a Fortitude save.}"
                          - p: ""

                  - tail:
                  # - spacer:

              - g:
                contents:
                  - section: "_{Racket}"
                    primary: true
                    contents:
                      - zone: '@rogue-racket'
                        contents:
                          - g:
                            contents:
                              - field: rogue-racket
                                size: huge
                                width: stretch
                                frame: none
                                merge-bottom: true
                              - hr:
                              - field: rogue-racket-special
                                label: "_{Special}"
                                width: stretch
                                repeat: 3
                              - field: rogue-racket-trained
                                label: "_{Trained}"
                                width: stretch
                                repeat: 2

                  - section: "_{Rogue Feats}"
                    contents:
                      # - paste: feats-table
                      #   class: rogue
                      #   levels: [ 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, '' ]
                      - list:
                        zebra: true
                        columns: 2
                        flowv: true
                        hr: true
                        contents:
                          - each:
                            template:
                              - level: "#{level}"
                                contents:
                                  - item:
                            contents:
                              - slots: [ 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, '' ]
                                min: 1
                                max: 1
                                placeholder:
                                  article:
                                  header:
                                    - field: rogue-feat-level-#{level}
                                      width: stretch
                                      frame: none
                                      align: left
                                  contents:
                                    - field: rogue-feat-level-#{level}-details
                                      width: stretch
                                      align: left
                                      frame: none
                                      repeat: 2
                                contents:
                                  - zone: '@rogue-feats'
                  - tail:
                  - spacer:
